import discord
from discord import Interaction, app_commands
from discord.ext import commands
import openai
import os # default module
from dotenv import load_dotenv

load_dotenv() # load all the variables from the env file

# Initialize OpenAI
openai.api_key = os.getenv('OPENAI')

intents = discord.Intents.default()
bot = discord.Client(intents=intents)
tree = app_commands.CommandTree(bot)

@bot.event
async def on_ready():
    print(f'Logged in as {bot.user.name}')

@tree.command(name="ping", description="Sends the bot's latency.") # this decorator makes a slash command
async def ping(interaction): # a slash command will be created with the name "ping"
    await interaction.respond.send_message(f"Pong! Latency is {bot.latency}")

@tree.command(
    name="say_something",
    description="Chopperbot says something",
)
async def hello(interaction: discord.Interaction):
    await interaction.send("Something")

@tree.command(
    name="ask_gpt",    
   description="Prompts ChatGPT"
)
async def ask(interaction: discord.Interaction, *, message:str):
    prompt = f"As a spicy, mysterious, nonchalant entity, {message}"
    response = await get_openai_response(prompt)
    await interaction.send(response)

async def get_openai_response(prompt):
    response = openai.Completion.create(
        engine="gpt-3.5-turbo",
        prompt=prompt,
        max_tokens=150
    )
    return response.choices[0].text.strip()

@bot.event
async def on_message(message):
    if message.author == bot.user:
        return
    
    # Check if the bot was mentioned
    if bot.user.mentioned_in(message):
        await message.channel.send(f'Shut up, {message.author.mention}!')
        
    # Check if the message contains 'chopperBot' (case insensitive)
    if 'chopperbot' in message.content.lower():
        if str(message.author) == "danooooooo":
            await message.channel.send(f'Hello, {message.author}!')
        elif str(message.author) == "proxy9108":
            await message.channel.send(f'Shut up, {message.author}!')
        elif str(message.author) == "tummyhurty":
            await message.channel.send(f'Shut up, Winston!!! ')
        elif str(message.author) == "baldooboona":
            await message.channel.send(f"What's up loser")
        elif str(message.author) == "chaoskunta":
            await message.channel.send(f"wsg cuh")
        elif str(message.author) == "chopperboi":
            await message.channel.send(f"Hola papa")
        else:
            await message.channel.send(f"Hi uwu")

# Bot's Token
bot.run(os.getenv('TOKEN'))
